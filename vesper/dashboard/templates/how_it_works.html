{% extends "base.html" %}
{% block title %}How It Works â€” Vesper{% endblock %}
{% block body %}

<div class="nav">
    <span class="nav-logo">vesper</span>
    <div class="nav-links">
        <a class="nav-link" href="/dashboard">Dashboard</a>
        <a class="nav-link active" href="/how-it-works">How it works</a>
        <a class="nav-link" href="/settings">Settings</a>
        <a class="nav-link" href="/logout">Log out</a>
    </div>
</div>

<div class="page-wrapper">
<div style="max-width:760px;margin:0 auto;padding:32px 0 64px;">

<h1 style="font-size:28px;font-weight:700;letter-spacing:-0.5px;margin-bottom:8px;">How Vesper Works</h1>
<p style="color:var(--text-secondary);font-size:15px;margin-bottom:40px;">
    Vesper is a fully autonomous AI trading system. You set a budget, press Start, and the AI handles everything &mdash; scanning markets, researching opportunities with Deep Search, entering positions, managing risk with trailing stops, and taking profits. No manual trading required.
</p>

<!-- Overview Diagram -->
<div class="card" style="padding:28px;margin-bottom:32px;">
    <div style="font-size:16px;font-weight:700;margin-bottom:16px;">System Overview</div>
    <div style="display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap;font-size:13px;font-weight:600;">
        <div class="stat-glass" style="padding:14px 16px;text-align:center;min-width:100px;">
            <div style="color:var(--accent);font-size:18px;margin-bottom:4px;">1</div>
            Market Scan
        </div>
        <div style="color:var(--text-muted);font-size:16px;">&rarr;</div>
        <div class="stat-glass" style="padding:14px 16px;text-align:center;min-width:100px;">
            <div style="color:var(--accent);font-size:18px;margin-bottom:4px;">2</div>
            Deep Search
        </div>
        <div style="color:var(--text-muted);font-size:16px;">&rarr;</div>
        <div class="stat-glass" style="padding:14px 16px;text-align:center;min-width:100px;">
            <div style="color:var(--accent);font-size:18px;margin-bottom:4px;">3</div>
            AI Analysis
        </div>
        <div style="color:var(--text-muted);font-size:16px;">&rarr;</div>
        <div class="stat-glass" style="padding:14px 16px;text-align:center;min-width:100px;">
            <div style="color:var(--accent);font-size:18px;margin-bottom:4px;">4</div>
            Auto Entry
        </div>
        <div style="color:var(--text-muted);font-size:16px;">&rarr;</div>
        <div class="stat-glass" style="padding:14px 16px;text-align:center;min-width:100px;">
            <div style="color:var(--accent);font-size:18px;margin-bottom:4px;">5</div>
            Trailing Exit
        </div>
    </div>
    <p style="color:var(--text-muted);font-size:12px;text-align:center;margin-top:16px;">
        This cycle runs every 60 seconds, 24/7. The AI continuously monitors all positions and scans for new opportunities.
    </p>
</div>

<!-- Deep Search -->
<div style="font-size:20px;font-weight:700;margin-bottom:16px;">Deep Search</div>

<div class="card" style="padding:24px;margin-bottom:32px;border-color:rgba(0,232,94,0.12);">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
        <div style="width:36px;height:36px;border-radius:10px;background:rgba(0,232,94,0.1);display:flex;align-items:center;justify-content:center;font-size:18px;color:var(--green);">&#x1F50D;</div>
        <div>
            <div style="font-size:16px;font-weight:700;">AI-Powered Web Research</div>
            <div style="font-size:12px;color:var(--text-muted);">Real-time intelligence for every trade decision</div>
        </div>
    </div>
    <div style="color:var(--text-secondary);font-size:13px;line-height:1.7;">
        <p>Before entering any position, Vesper runs a <strong>Deep Search</strong> using Perplexity Sonar AI to scour the live web for the latest information about each asset:</p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0;">
            <div class="stat-glass" style="padding:12px;">
                <div style="font-size:12px;font-weight:600;color:var(--accent);margin-bottom:4px;">News & Events</div>
                <div style="font-size:11px;color:var(--text-muted);">Breaking news, earnings reports, protocol upgrades, regulatory changes, and macro events that could impact price.</div>
            </div>
            <div class="stat-glass" style="padding:12px;">
                <div style="font-size:12px;font-weight:600;color:var(--accent);margin-bottom:4px;">Social Sentiment</div>
                <div style="font-size:11px;color:var(--text-muted);">Trending discussions on crypto Twitter, Reddit, Discord. Community excitement or FUD indicators.</div>
            </div>
            <div class="stat-glass" style="padding:12px;">
                <div style="font-size:12px;font-weight:600;color:var(--accent);margin-bottom:4px;">On-Chain Data</div>
                <div style="font-size:11px;color:var(--text-muted);">Whale movements, exchange inflows/outflows, DEX volume spikes, and smart money tracking.</div>
            </div>
            <div class="stat-glass" style="padding:12px;">
                <div style="font-size:12px;font-weight:600;color:var(--accent);margin-bottom:4px;">Expert Analysis</div>
                <div style="font-size:11px;color:var(--text-muted);">Analyst price targets, institutional coverage, fundamental thesis from crypto researchers and financial experts.</div>
            </div>
        </div>
        <p>The search results are then fed to <strong>Claude AI</strong> which synthesizes all the evidence into a calibrated buy/sell/hold decision with bullish and bearish factors. This gives the AI a forward-looking edge that pure technical analysis cannot provide.</p>
        <p style="margin-top:8px;padding:8px 12px;border-radius:8px;background:rgba(0,232,94,0.04);border:1px solid rgba(0,232,94,0.1);font-size:12px;">
            Deep Search runs on every crypto and stock candidate. You can see the full research by clicking <strong>"Learn More"</strong> on any active position card.
        </p>
    </div>
</div>

<!-- 3 Segments -->
<div style="font-size:20px;font-weight:700;margin-bottom:16px;">Three Autopilot Segments</div>

<!-- Crypto -->
<div class="card" style="padding:24px;margin-bottom:16px;">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
        <div style="width:36px;height:36px;border-radius:10px;background:rgba(0,232,94,0.1);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;color:var(--green);">&#8383;</div>
        <div>
            <div style="font-size:16px;font-weight:700;">Crypto Autopilot</div>
            <div style="font-size:12px;color:var(--text-muted);">Altcoin trend hunter with Deep Search</div>
        </div>
    </div>
    <div style="color:var(--text-secondary);font-size:13px;line-height:1.7;">
        <p><strong>What it scans:</strong> 60+ altcoins on Coinbase (BTC, ETH, SOL, DOGE, PEPE, SUI, AVAX, LINK, etc.)</p>
        <p style="margin-top:8px;"><strong>How it decides:</strong> Each coin goes through a 3-stage pipeline:</p>
        <div style="margin:10px 0 10px 16px;font-size:12px;">
            <div style="margin-bottom:8px;">
                <span style="color:var(--accent);font-weight:600;">Stage 1 &mdash; Technical Score:</span>
                <span style="color:var(--text-muted);"> 6-factor analysis: Momentum (MACD), RSI (50-70 ideal), EMA alignment, Volume surge, ADX trend strength, BTC relative strength. Score &ge; 0.55 = candidate.</span>
            </div>
            <div style="margin-bottom:8px;">
                <span style="color:var(--accent);font-weight:600;">Stage 2 &mdash; Deep Search:</span>
                <span style="color:var(--text-muted);"> Perplexity AI searches the web for latest news, sentiment, whale activity, and catalysts for each candidate coin.</span>
            </div>
            <div>
                <span style="color:var(--accent);font-weight:600;">Stage 3 &mdash; AI Decision:</span>
                <span style="color:var(--text-muted);"> Claude AI synthesizes technical + fundamental data. Only enters if both technical score AND AI reasoning align.</span>
            </div>
        </div>
        <p><strong>Risk management:</strong> Adaptive stop-loss based on volatility (ATR). <strong>Trailing stops (2%)</strong> follow price up, locking in gains with unlimited upside. Positions with weakening trends (score &lt; 0.40) are auto-closed and capital is redeployed.</p>
    </div>
</div>

<!-- Stocks -->
<div class="card" style="padding:24px;margin-bottom:16px;">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
        <div style="width:36px;height:36px;border-radius:10px;background:rgba(99,102,241,0.1);display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#818cf8;">&#x1F4C8;</div>
        <div>
            <div style="font-size:16px;font-weight:700;">Stocks Autopilot</div>
            <div style="font-size:12px;color:var(--text-muted);">AI portfolio manager with Deep Search</div>
        </div>
    </div>
    <div style="color:var(--text-secondary);font-size:13px;line-height:1.7;">
        <p><strong>What it scans:</strong> Top 20 crypto pairs + 20 US stocks (NVDA, AAPL, TSLA, META, AMZN, GOOGL via Alpaca)</p>
        <p style="margin-top:8px;"><strong>How it decides:</strong> 7-layer AI brain:</p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px 16px;margin:10px 0 10px 16px;font-size:12px;">
            <div><span style="color:var(--accent);">1.</span> Technical ensemble (3 strategies vote)</div>
            <div><span style="color:var(--accent);">2.</span> Multi-timeframe alignment (1h + 4h)</div>
            <div><span style="color:var(--accent);">3.</span> Order book pressure (bid/ask)</div>
            <div><span style="color:var(--accent);">4.</span> Whale activity tracking</div>
            <div><span style="color:var(--accent);">5.</span> Market sentiment analysis</div>
            <div><span style="color:var(--accent);">6.</span> ADX trend strength filter</div>
            <div style="grid-column:span 2;"><span style="color:var(--accent);">7.</span> <strong>Deep Search</strong> &mdash; live web research for news, catalysts, and analyst sentiment via Perplexity + Claude</div>
        </div>
        <p>The AI can <strong>override technical signals</strong> when Deep Search reveals bullish fundamentals, whale accumulation, or positive sentiment that technical analysis alone would miss.</p>
        <p style="margin-top:8px;"><strong>Risk management:</strong> Dynamic stop-loss scaled by ATR. Take-profit range scales with confidence. Trailing stops enabled. Funds are split evenly across up to 3 positions.</p>
    </div>
</div>

<!-- Predictions -->
<div class="card" style="padding:24px;margin-bottom:32px;">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
        <div style="width:36px;height:36px;border-radius:10px;background:rgba(245,166,35,0.1);display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#f5a623;">&#x1F52E;</div>
        <div>
            <div style="font-size:16px;font-weight:700;">Predictions Autopilot</div>
            <div style="font-size:12px;color:var(--text-muted);">AI-powered prediction markets</div>
        </div>
    </div>
    <div style="color:var(--text-secondary);font-size:13px;line-height:1.7;">
        <p><strong>What it scans:</strong> Live prediction markets on Polymarket &amp; Kalshi (politics, economics, tech, sports, etc.)</p>
        <p style="margin-top:8px;"><strong>How it decides (2-stage AI pipeline):</strong></p>
        <div style="margin:10px 0 10px 16px;font-size:12px;">
            <div style="margin-bottom:8px;">
                <span style="color:#f5a623;font-weight:600;">Stage 1 &mdash; Perplexity Sonar:</span>
                <span style="color:var(--text-muted);"> Searches the live web for latest news, expert opinions, polls, data points, and historical context about each market question.</span>
            </div>
            <div>
                <span style="color:#f5a623;font-weight:600;">Stage 2 &mdash; Claude AI:</span>
                <span style="color:var(--text-muted);"> Deep reasoning on the gathered evidence. Produces a calibrated probability estimate, confidence level, and structured yes/no factors.</span>
            </div>
        </div>
        <p>The AI compares its probability estimate against the market price. If the edge (difference) exceeds 5%, it places a bet on the underpriced side.</p>
        <p style="margin-top:8px;"><strong>Rate limit:</strong> Runs every 60 minutes. Researches top 3 markets per cycle. Results cached for 4 hours.</p>
    </div>
</div>

<!-- Risk Management -->
<div style="font-size:20px;font-weight:700;margin-bottom:16px;">Risk Management</div>

<div class="card" style="padding:24px;margin-bottom:16px;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
        <div>
            <div style="font-size:14px;font-weight:700;color:var(--red);margin-bottom:8px;">Stop-Loss Protection</div>
            <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">
                Every position has an automatic stop-loss based on the asset's volatility (ATR). More volatile assets get wider stops. If price drops below the stop-loss, the position is closed immediately to limit losses.
            </div>
        </div>
        <div>
            <div style="font-size:14px;font-weight:700;color:var(--accent);margin-bottom:8px;">Trailing Stops</div>
            <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">
                As price rises, the stop-loss follows it up. This locks in gains while letting winners run. Example: 2% trailing stop &mdash; if price peaks at $115, stop-loss moves to $112.70. Unlimited upside, protected downside.
            </div>
        </div>
        <div>
            <div style="font-size:14px;font-weight:700;color:#0af;margin-bottom:8px;">Auto-Rebalancing</div>
            <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">
                The Crypto autopilot continuously re-evaluates positions. If a coin's trend weakens (score drops below 0.40), the AI sells it and redeploys the capital into the next strongest opportunity.
            </div>
        </div>
        <div>
            <div style="font-size:14px;font-weight:700;color:#f80;margin-bottom:8px;">Capital Isolation</div>
            <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">
                Each autopilot has its own budget. Crypto losses don't affect your Stocks fund. Predictions losses don't touch your crypto. Total risk is always capped at what you allocate.
            </div>
        </div>
    </div>
</div>

<!-- Risk Levels -->
<div class="card" style="padding:24px;margin-bottom:32px;">
    <div style="font-size:14px;font-weight:700;margin-bottom:14px;">Risk Levels</div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
        <div class="stat-glass" style="padding:14px;border-color:rgba(0,170,255,0.15);">
            <div style="font-size:13px;font-weight:700;color:#0af;margin-bottom:6px;">Conservative</div>
            <div style="font-size:11px;color:var(--text-muted);line-height:1.5;">
                Higher confidence thresholds. Fewer but more certain trades. Tighter stop-losses. Best for capital preservation.
            </div>
        </div>
        <div class="stat-glass" style="padding:14px;border-color:rgba(255,165,0,0.15);">
            <div style="font-size:13px;font-weight:700;color:#f90;margin-bottom:6px;">Moderate</div>
            <div style="font-size:11px;color:var(--text-muted);line-height:1.5;">
                Balanced approach. Standard confidence thresholds. Medium stop-loss widths. Good risk-reward balance.
            </div>
        </div>
        <div class="stat-glass" style="padding:14px;border-color:rgba(0,232,94,0.15);">
            <div style="font-size:13px;font-weight:700;color:var(--green);margin-bottom:6px;">Aggressive</div>
            <div style="font-size:11px;color:var(--text-muted);line-height:1.5;">
                Lower thresholds. More frequent trades. Wider stops give more room. Maximum upside potential.
            </div>
        </div>
    </div>
</div>

<!-- Continuous Trading -->
<div class="card" style="padding:24px;margin-bottom:32px;">
    <div style="font-size:14px;font-weight:700;margin-bottom:10px;">Continuous Mode</div>
    <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">
        When a position hits its take-profit or trailing stop, the autopilot doesn't just pocket the gain &mdash; it <strong>re-enters</strong> at the new price with the same capital. This compounds returns over time. If the trend continues, you ride consecutive waves. If it reverses, the stop-loss protects you on the new entry.
    </div>
</div>

<!-- Paper vs Live -->
<div style="font-size:20px;font-weight:700;margin-bottom:16px;">Paper vs Live Trading</div>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:32px;">
    <div class="card" style="padding:24px;">
        <div style="font-size:14px;font-weight:700;margin-bottom:8px;">
            <span style="display:inline-block;padding:2px 8px;border-radius:8px;background:rgba(245,166,35,0.12);color:#f5a623;font-size:11px;font-weight:600;margin-right:6px;">DEFAULT</span>
            Paper Mode
        </div>
        <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">
            Simulated trading with virtual balance. All strategies run in real-time with real market data, but no actual orders are placed. Use this to validate the AI's performance before committing real funds.
        </div>
    </div>
    <div class="card" style="padding:24px;">
        <div style="font-size:14px;font-weight:700;margin-bottom:8px;">
            <span style="display:inline-block;padding:2px 8px;border-radius:8px;background:rgba(255,59,48,0.12);color:var(--red);font-size:11px;font-weight:600;margin-right:6px;">ADVANCED</span>
            Live Mode
        </div>
        <div style="font-size:12px;color:var(--text-secondary);line-height:1.6;">
            Real orders on Coinbase (crypto) and Alpaca (stocks). Requires API keys configured in Settings. A confirmation dialog is shown before switching to real mode. Start small.
        </div>
    </div>
</div>

<!-- Technical Architecture -->
<div style="font-size:20px;font-weight:700;margin-bottom:16px;">Under the Hood</div>

<div class="card" style="padding:24px;margin-bottom:32px;">
    <div style="font-size:12px;color:var(--text-secondary);line-height:1.8;">
        <div style="display:grid;grid-template-columns:140px 1fr;gap:8px 16px;">
            <span style="color:var(--text-muted);font-weight:600;">Cycle frequency</span>
            <span>Every 60 seconds</span>
            <span style="color:var(--text-muted);font-weight:600;">Market data</span>
            <span>Coinbase (crypto), Alpaca (stocks), Polymarket &amp; Kalshi (predictions)</span>
            <span style="color:var(--text-muted);font-weight:600;">AI models</span>
            <span>Perplexity Sonar (Deep Search) + Claude (reasoning &amp; decision)</span>
            <span style="color:var(--text-muted);font-weight:600;">Strategies</span>
            <span>Trend following, mean reversion, momentum &mdash; combined via weighted ensemble</span>
            <span style="color:var(--text-muted);font-weight:600;">Intelligence</span>
            <span>Deep Search (web research), whale tracking, order book analysis, sentiment, Fear &amp; Greed</span>
            <span style="color:var(--text-muted);font-weight:600;">Indicators</span>
            <span>RSI, MACD, EMA 12/26/50, Bollinger Bands, ADX, ATR, Volume SMA</span>
            <span style="color:var(--text-muted);font-weight:600;">Risk tools</span>
            <span>Trailing stops, ATR-based SL, dynamic TP, auto-rebalancing, capital isolation</span>
            <span style="color:var(--text-muted);font-weight:600;">Infrastructure</span>
            <span>Docker container on dedicated VPS, auto-restart, 24/7 uptime</span>
        </div>
    </div>
</div>

<div style="text-align:center;padding:16px 0;color:var(--text-muted);font-size:12px;">
    Questions? Check <a href="/settings">Settings</a> to connect your exchange accounts, or head back to the <a href="/dashboard">Dashboard</a> to start an autopilot.
</div>

</div>
</div>

{% endblock %}
