{% extends "base.html" %}
{% block title %}Vesper â€” Setup 2FA{% endblock %}
{% block body %}
<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;padding:24px;">
    <div style="width:100%;max-width:420px;">

        <div style="text-align:center;margin-bottom:32px;">
            <div style="font-size:24px;font-weight:700;letter-spacing:-1px;">Two-Factor Authentication</div>
            <div style="font-size:14px;color:var(--text-secondary);margin-top:4px;">Scan with your authenticator app</div>
        </div>

        {% if error == "invalid_code" %}
        <div class="alert alert-error">Invalid code. Try again.</div>
        {% endif %}

        {% if qr_b64 %}
        <div style="text-align:center;margin-bottom:24px;">
            <div style="background:#fff;border-radius:16px;padding:20px;display:inline-block;">
                <img src="data:image/png;base64,{{ qr_b64 }}" alt="2FA QR" style="width:180px;height:180px;">
            </div>
        </div>
        {% endif %}

        <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:24px;text-align:center;">
            <div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px;">Manual key</div>
            <div style="font-family:monospace;font-size:14px;color:var(--accent);word-break:break-all;letter-spacing:1px;">{{ totp_secret }}</div>
        </div>

        <form method="POST" action="/register/verify-2fa">
            <input type="hidden" name="email" value="{{ email }}">
            <input type="hidden" name="pw_hash" value="{{ pw_hash }}">
            <input type="hidden" name="totp_secret" value="{{ totp_secret }}">

            <div class="input-group">
                <label class="input-label" for="totp_code">6-digit code</label>
                <input class="input" type="text" name="totp_code" id="totp_code" placeholder="000 000"
                       inputmode="numeric" pattern="[0-9]{6}" maxlength="6"
                       autocomplete="one-time-code" autofocus required
                       style="text-align:center;font-size:24px;letter-spacing:12px;font-weight:600;">
            </div>
            <button type="submit" class="btn btn-accent btn-full" style="padding:14px;">
                Verify & Create Account
            </button>
        </form>

        <div style="text-align:center;margin-top:20px;">
            <a href="/register" style="font-size:13px;color:var(--text-muted);">Back</a>
        </div>
    </div>
</div>
{% endblock %}
