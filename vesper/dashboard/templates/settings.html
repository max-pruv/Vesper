{% extends "base.html" %}
{% block title %}Vesper â€” Settings{% endblock %}
{% block body %}
<div class="nav">
    <span class="nav-logo">vesper</span>
    <div class="nav-links">
        <a class="nav-link" href="/dashboard">Dashboard</a>
        <a class="nav-link active" href="/settings">Settings</a>
        <a class="nav-link" href="/logout">Log out</a>
    </div>
</div>

<div class="container" style="max-width:680px;">

    {% if msg == "keys_saved" %}
    <div class="alert alert-success">API keys encrypted and saved.</div>
    {% elif msg == "config_saved" %}
    <div class="alert alert-success">Configuration updated.</div>
    {% elif msg == "mode_changed" %}
    <div class="alert alert-success">Trading mode updated.</div>
    {% endif %}

    <!-- API Keys -->
    <div class="card">
        <div class="card-title">Exchange Connection</div>

        <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
            <div style="width:40px;height:40px;border-radius:10px;background:{{ 'var(--green-dim)' if has_api_keys else 'rgba(255,255,255,0.04)' }};display:flex;align-items:center;justify-content:center;">
                {% if has_api_keys %}
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg>
                {% else %}
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01"/></svg>
                {% endif %}
            </div>
            <div>
                <div style="font-size:14px;font-weight:600;">Coinbase Advanced</div>
                <div style="font-size:12px;color:{{ 'var(--green)' if has_api_keys else 'var(--text-muted)' }};">
                    {{ 'Connected' if has_api_keys else 'Not connected' }}
                </div>
            </div>
        </div>

        <form method="POST" action="/settings/api-keys">
            <div class="input-group">
                <label class="input-label" for="api_key">API Key</label>
                <input class="input" type="password" name="api_key" id="api_key"
                       placeholder="{{ 'Saved \u2022 enter new to replace' if has_api_keys else 'Paste your API key' }}" required>
            </div>
            <div class="input-group">
                <label class="input-label" for="api_secret">Private Key</label>
                <input class="input" type="password" name="api_secret" id="api_secret"
                       placeholder="{{ 'Saved \u2022 enter new to replace' if has_api_keys else 'Paste your private key' }}" required>
            </div>
            <button type="submit" class="btn btn-accent btn-sm">Save Keys</button>
        </form>
    </div>

    <!-- Trading Config -->
    <div class="card">
        <div class="card-title">Trading</div>
        <form method="POST" action="/settings/trading">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                <div class="input-group">
                    <label class="input-label" for="symbols">Assets</label>
                    <input class="input" type="text" name="symbols" id="symbols" value="{{ user.symbols }}">
                </div>
                <div class="input-group">
                    <label class="input-label" for="interval_minutes">Interval</label>
                    <select class="input" name="interval_minutes" id="interval_minutes">
                        <option value="15" {{ 'selected' if user.interval_minutes == 15 }}>Every 15 min</option>
                        <option value="30" {{ 'selected' if user.interval_minutes == 30 }}>Every 30 min</option>
                        <option value="60" {{ 'selected' if user.interval_minutes == 60 }}>Every hour</option>
                        <option value="240" {{ 'selected' if user.interval_minutes == 240 }}>Every 4 hours</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label" for="paper_balance">Paper Balance</label>
                    <input class="input" type="number" name="paper_balance" id="paper_balance"
                           value="{{ user.paper_balance }}" step="1" min="10">
                </div>
                <div class="input-group" style="display:none;">
                    <input type="hidden" name="trading_mode" value="{{ user.trading_mode }}">
                </div>
            </div>

            <div class="card-title" style="margin-top:8px;">Risk Management</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                <div class="input-group">
                    <label class="input-label" for="stop_loss_pct">Stop-Loss %</label>
                    <input class="input" type="number" name="stop_loss_pct" id="stop_loss_pct"
                           value="{{ user.stop_loss_pct }}" step="0.1" min="0.5" max="10">
                </div>
                <div class="input-group">
                    <label class="input-label" for="take_profit_min_pct">Take-Profit Min %</label>
                    <input class="input" type="number" name="take_profit_min_pct" id="take_profit_min_pct"
                           value="{{ user.take_profit_min_pct }}" step="0.1" min="0.5" max="20">
                </div>
                <div class="input-group">
                    <label class="input-label" for="take_profit_max_pct">Take-Profit Max %</label>
                    <input class="input" type="number" name="take_profit_max_pct" id="take_profit_max_pct"
                           value="{{ user.take_profit_max_pct }}" step="0.1" min="1" max="50">
                </div>
                <div class="input-group">
                    <label class="input-label" for="max_position_pct">Max Position %</label>
                    <input class="input" type="number" name="max_position_pct" id="max_position_pct"
                           value="{{ user.max_position_pct }}" step="1" min="5" max="100">
                </div>
            </div>
            <button type="submit" class="btn btn-accent btn-sm">Save</button>
        </form>
    </div>

    <!-- Account -->
    <div class="card">
        <div class="card-title">Account</div>
        <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
                <div style="font-size:15px;font-weight:500;">{{ user.email }}</div>
                <div style="font-size:12px;color:var(--green);margin-top:2px;">2FA Active</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
